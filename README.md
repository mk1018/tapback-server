# Tapback

モバイル端末からClaude Code/Codexのターミナルを監視・操作するmacOSアプリ。

## 概要

Tapbackは、Mac上で動作するClaude CodeやCodexなどのAIコーディングアシスタントを、iPhoneやiPadからリアルタイムで監視・操作するためのアプリです。

### 仕組み

1. **ターミナル監視**: tmuxセッションの出力をキャプチャし、WebSocket経由でモバイルに配信
2. **リバースプロキシ**: localhostで動作するWebアプリへのリクエストを中継（ngrok風）
3. **同一ネットワーク**: MacとモバイルがでアクセスWi-Fi経由可能

## 機能

- **複数セッション監視** - 複数のtmuxセッションを同時に監視
- **リバースプロキシ** - localhostで動作するWebアプリをモバイルからアクセス可能に
- **PIN認証** - 4桁PINによるセキュアアクセス（無効化可能）
- **モバイル最適化UI** - タブ切り替えでセッション/Webアプリを操作
- **クイック入力** - 0〜4のボタンでClaude Codeの選択肢に即座に応答

## 必要環境

- macOS 13+
- tmux
- 同一ネットワーク上のモバイル端末

## 環境セットアップ

### tmuxのインストール

Tapbackはtmuxを使用してターミナルセッションを管理します。

```bash
# Homebrewでインストール
brew install tmux
```

インストール確認:

```bash
which tmux
# 出力例: /opt/homebrew/bin/tmux (Apple Silicon)
# 出力例: /usr/local/bin/tmux (Intel Mac)
```

### PATHについて

アプリは以下のパスでtmuxを検索します:

- `/opt/homebrew/bin` (Apple Silicon)
- `/usr/local/bin` (Intel Mac)

Homebrewでインストールした場合は自動的に認識されます。

### ソースからビルドする場合

```bash
# Xcodeコマンドラインツール
xcode-select --install

# Swift 5.9以上が必要
swift --version
```

## インストール

### GitHub Releasesからダウンロード

1. [Releases](https://github.com/mk1018/tapback-code/releases)から最新の`Tapback-vX.X.X-arm64.zip`をダウンロード
2. ZIPを展開
3. `Tapback.app`を`/Applications`に移動
4. 初回起動時に以下を実行（署名されていないため）:

   ```bash
   xattr -cr /Applications/Tapback.app
   open /Applications/Tapback.app
   ```

### ソースからビルド

```bash
swift build
swift run TapbackApp
```

## 使い方

### 基本的な流れ

#### 方法1: アプリ内でセッションを新規作成

1. **Tapbackを起動**

   ```bash
   swift run TapbackApp
   ```

2. **セッションを新規作成**
   - 「+」ボタンをクリック
   - 「新規作成」タブを選択
   - 名前とタイプを入力
   - 「Add」をクリック

3. **アプリ内ターミナルで操作**
   - 作成したセッションを選択
   - アプリ内のターミナルで直接操作可能

#### 方法2: 既存のtmuxセッションを監視

1. **別のターミナルでtmuxセッションを起動**

   ```bash
   tmux new -s claude
   claude
   ```

2. **Tapbackを起動**

   ```bash
   swift run TapbackApp
   ```

3. **セッションを追加**
   - 「+」ボタンをクリック
   - 「既存を監視」タブを選択
   - tmuxセッション（例: claude）を選択
   - 「Add」をクリック

4. **サーバーを起動**
   - 「Start」をクリック
   - 表示されるURL（例: `http://192.168.1.10:9876/`）をメモ

5. **モバイルでアクセス**
   - SafariでURLを開く
   - PINを入力（有効時）
   - ターミナル出力がリアルタイムで表示される

### Webアプリのプロキシ

localhost:3000で動作するNext.jsアプリをモバイルで確認する場合:

1. **Proxy Settingsを開く**（サーバー停止中）
2. **ポートマッピングを追加**
   - Target: `3000`（ローカルのポート）
   - External: `9877`（外部公開ポート）
3. **サーバーを起動**
4. **モバイルでアクセス**
   - Terminalタブ: ターミナル監視
   - Appタブ: Webアプリを表示

### 複数ポートの設定

Supabaseなど複数のローカルサービスを使用する場合:

| Target | External | 用途     |
| ------ | -------- | -------- |
| 3000   | 9877     | Next.js  |
| 54321  | 9878     | Supabase |

レスポンス内のlocalhost参照は自動的にMacのIPに書き換えられます。

## アーキテクチャ

```text
┌─────────────────────────────────────────────────────────┐
│ Mac                                                     │
│  ┌─────────────┐     ┌─────────────┐                   │
│  │ tmux        │────▶│ Tapback    │                   │
│  │ (claude)    │     │ App        │                   │
│  └─────────────┘     └──────┬──────┘                   │
│                             │                          │
│  ┌─────────────┐     ┌──────┴──────┐                   │
│  │ localhost   │◀───▶│ Proxy      │                   │
│  │ :3000       │     │ Server     │                   │
│  └─────────────┘     └──────┬──────┘                   │
│                             │ :9876 (Terminal)         │
│                             │ :9877 (Proxy)            │
└─────────────────────────────┼───────────────────────────┘
                              │ Wi-Fi
┌─────────────────────────────┼───────────────────────────┐
│ iPhone                      │                          │
│  ┌─────────────────────────┴────────────────────────┐  │
│  │ Safari                                           │  │
│  │  ┌─────────┐ ┌─────────┐                        │  │
│  │  │Terminal │ │  App    │                        │  │
│  │  │  Tab    │ │  Tab    │                        │  │
│  │  └─────────┘ └─────────┘                        │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

## 設定

### PIN認証

- サーバー停止中に「PIN」トグルで有効/無効を切り替え
- 有効時: 4桁のPINが自動生成され、初回アクセス時に入力が必要
- 無効時: 認証なしで直接アクセス可能

### セッション管理

- 右クリックで編集・削除
- トグルスイッチで有効/無効を切り替え

## フォーマット

```bash
swiftformat Sources
```

## ライセンス

MIT
